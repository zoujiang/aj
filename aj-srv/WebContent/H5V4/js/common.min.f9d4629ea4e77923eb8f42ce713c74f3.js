function getUrlParams(){var e=location.search,t=new Object;if(-1!=e.indexOf("?"))for(var n=e.substr(1),a=n.split("&"),i=0;i<a.length;i++)t[a[i].split("=")[0]]=a[i].split("=")[1];return t}function addCookie(e,t,n){console.log("[Cookie]Add:"+e+","+t+","+n);var a=e+"="+escape(t);if(n>0){var i=new Date;i.setTime(i.getTime()+3600*n*1e3),a=a+"; expires="+i.toGMTString()}document.cookie=a}function getCookie(e){for(var t=document.cookie,n=t.split("; "),a=0;a<n.length;a++){var i=n[a].split("=");if(i[0]==e)return unescape(i[1])}return""}function $node(e){return document.getElementById(e)}function $listen(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent(t,n)}function $unlisten(e,t,n){e.removeEventListener?e.removeEventListener(t,n):e.detachEvent&&e.detachEvent(t,n)}function calcImgClip(e,t,n,a){var i,o,s,r;return n/a>e/t?(o=t,i=Math.floor(t*(n/a))):(i=e,o=Math.floor(e*(a/n))),s=(i-e)/2,r=(o-t)/2,{objWidth:i,objHeight:o,clipLeft:s,clipTop:r}}function hasClass(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function addClass(e,t){hasClass(e,t)||(e.className+=" "+t)}function removeClass(e,t){if(hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n,"")}}function QOS_Report(e,t){$.ajax({type:"POST",url:"http://qos.ttxuanpai.com/data/report",data:JSON.stringify({type:e,data:{value:t}}),dataType:"json"}),console.log("reportData, type:"+e+", value:"+JSON.stringify(t))}function QOS_Error(e){QOS_Report("ERROR",e)}function QOS_Err(e,t){QOS_Report("ERR",{code:e,context:t})}function QOS_Stat(e,t){QOS_Report("STAT",{name:e,time:t})}function $transform(e,t){e.style.transform=e.style["-webkit-transform"]=e.style["-ms-transform"]=t}function is_iOS(){return!!/iPhone|iPad|iPod/i.test(navigator.userAgent)}function $click(e,t){$(e).on("touchstart",function(){$(this).data("touch-move",0)}).on("touchmove",function(){$(this).data("touch-move",1)}).on("touchend",function(e){0==$(this).data("touch-move")&&(t(this),e.stopPropagation())})}function ttxp_effect_meteor(e,t,n){var a=document.createElement("img");a.className="ttxp_effect_meteor",a.src="http://cdn.ttxuanpai.com/album_template/effect/images/meteor.png",$(a).width(104).height(33).css("left",t+"px").css("top",n+"px").css("opacity",.7);var i=90*Math.random(),o=0,s=.8*Math.random()+.2,r="rotate("+i+"deg) translate3d(0,0,"+o+"px)scale3d("+s+","+s+","+s+")";$transform(a,r);var c=parseInt(1+3*Math.random());$(a).css("webkitAnimationDelay",c+"s").css("animationDelay",c+"s"),e.appendChild(a),window.setTimeout(function(){a.style.display="block"},5e3*Math.random())}function ttxp_effect_snow(e,t,n){var a=document.createElement("div");a.className="ttxp_effect_snow",a.innerHTML="<img>";var i=$(a).find("img");i[0].src="http://cdn.ttxuanpai.com/album_template/effect/images/snow_"+(1+Math.floor(4*Math.random()))+".png",$(a).width(42).height(44).css("left",Math.random()*t+"px").css("top","-100px"),i.css("opacity",.9).width(42).height(44),a.style.webkitAnimationName="kf_ttxp_snow_fade, kf_ttxp_snow_drop";var o=Math.random()<.5?"kf_ttxp_snow_clockwiseSpin":"kf_ttxp_snow_counterclockwiseSpinAndFlip";i.css("-webkit-animation-name",o).css("animation-name",o);var s=function(e,t){return e+Math.random()*(t-e)},r=s(10,15)+"s",c=s(4,8)+"s";a.style.webkitAnimationDuration=r+", "+r;var l=s(0,15)+"s";a.style.webkitAnimationDelay=l+", "+l,i[0].style.webkitAnimationDuration=c,e.appendChild(a)}function TTXP_Create_Effect_Snow(e,t,n){new ttxp_effect_snow(e,t,n)}function ttxp_effect_star(e,t,n){var a=document.createElement("img");a.className="ttxp_effect_star",a.src="http://cdn.ttxuanpai.com/album_template/effect/images/star.png",$(a).width(21).height(22).css("left",t+"px").css("top",n+"px").css("opacity",.7);var i=90*Math.random(),o=0,s=.8*Math.random()+.2,r="rotate("+i+"deg) translate3d(0,0,"+o+"px)scale3d("+s+","+s+","+s+")";$transform(a,r);var c=parseInt(5+5*Math.random());$(a).css("webkitAnimationDuration",c+"s").css("animationDuration",c+"s"),e.appendChild(a),window.setTimeout(function(){a.style.display="block"},5e3*Math.random())}function checkOpenId(){var e="uid";if(""!=getCookie(e))console.log("Openid use cookie");else{var t=getUrlParams(),n=t.openid;if(void 0==n){console.log("openid is not exist, redirect");var a=location.href;a=a.replace(/\./g,"_d_"),a=a.replace(/\:/g,"_mh_"),a=a.replace(/\//g,"_xg_"),a=a.replace(/\?/g,"_wh_"),a=a.replace(/\&/g,"_y_"),a=a.replace(/\=/g,"_dh_");var i="wx1f77672efbc50503",o="http://wxauth.kagirl.net/wx/callback_ttxuanpai.php";o=o+"?back_url="+a,location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+i+"&redirect_uri="+encodeURIComponent(o)+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"}else n=pure_urlparam_value(n),console.log("Get redirect openid:"+n),addCookie(e,n,72)}}function getUID(){return get_kawa_openid()}function get_kawa_openid(){return pure_urlparam_value(getCookie("uid"))}function get_ttxp_openid(){return pure_urlparam_value(getCookie("openid_ttxp"))}function getUserInfo(){try{var e=getCookie("ttxp_userinfo");return""==e?null:JSON.parse(e)}catch(t){return console.log("exception when getUserInfo,msg:"+t.message+", desc:"+t.description),null}}function checkWxUserInfo(){var e="ttxp_userinfo";if(""!=getCookie(e))console.log("User info use cookie");else{var t=getUrlParams(),n=t.openid;if(void 0==n){console.log("openid is not exist, redirect");var a=location.href;a=a.replace(/\./g,"_d_"),a=a.replace(/\:/g,"_mh_"),a=a.replace(/\//g,"_xg_"),a=a.replace(/\?/g,"_wh_"),a=a.replace(/\&/g,"_y_"),a=a.replace(/\=/g,"_dh_");var i="wx1f77672efbc50503",o="http://wxauth.kagirl.net/wx/userinfo_ttxp.php";o=o+"?back_url="+a,location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+i+"&redirect_uri="+encodeURIComponent(o)+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect"}else{console.log("Get redirect info:"+n),addCookie("uid",n,72);var s={openid:n,headimgurl:decodeURIComponent(t.headimgurl),nickname:decodeURIComponent(t.nickname),sex:t.sex};addCookie(e,JSON.stringify(s),72)}}}function _get_user_openid(e,t,n,a){if(""!=getCookie(e))return pure_urlparam_value(getCookie(e));var i=getUrlParams(),o=i[t];if(void 0==o){console.log("openid is not exist, redirect");var s=location.href;s=s.replace(/\./g,"_d_"),s=s.replace(/\:/g,"_mh_"),s=s.replace(/\//g,"_xg_"),s=s.replace(/\?/g,"_wh_"),s=s.replace(/\&/g,"_y_"),s=s.replace(/\=/g,"_dh_"),a=a+"?back_url="+s,location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+n+"&redirect_uri="+encodeURIComponent(a)+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"}else o=pure_urlparam_value(o),console.log("Get redirect openid:"+o),addCookie(e,o,72)}function check_kawa_openid(){return _get_user_openid("uid","openid","wx1f77672efbc50503","http://wxauth.kagirl.net/wx/callback_ttxuanpai.php")}function check_ttxp_openid(){return _get_user_openid("openid_ttxp","openid_ttxp","wxd81c59ed138e9e74","http://wxauth.ttxuanpai.com/openid.php")}function pure_urlparam_value(e){if(e){var t=e.indexOf("?");t>0&&(e=e.substring(0,t))}return e}function wxImgUploader(){var e=[],t=0,n=!1;this.pushTask=function(i,o){var s={localId:i,callback:o,id:t++};console.log("add upload task #"+s.id),e.push(s),0==n&&a()};var a=function(){e.length>0&&(n=!0,window.setTimeout(function(){o(e.pop())},100))},i=function(e,t,i){console.log("end upload task #"+t.id+", ret:"+e+", serverId:"+i),n=!1,t.callback(e,t.localId,i),a()},o=function(e){console.log("begin upload task #"+e.id+", id:"+e.localId),wx.uploadImage({localId:e.localId,isShowProgressTips:0,success:function(t){i(!0,e,t.serverId)},fail:function(){i(!1,e,"")},complete:function(){console.log("[wx]upload image complete #",e.id)}})}}TTXP_Animation_Mgr=new function(){function e(e){var r=$(this).data(t),c=o(this),l=c>-1?i[c]:null,p=l&&l.param[n],d=l&&l.param[a];if(p&&p(this,e.animationName),e.animationName==r)d&&d(this);else{var u=l.param.animates[++i[c].frame];s(this,u)}}var t="animation-mgr-last-animation-name",n="progress",a="end",i=[],o=function(e){for(var t=0;t<i.length;++t)if(i[t].obj==e)return t;return-1};this.animate=function(n,a){if(a&&a.animates&&!(a.animates.length<1)){$(n).data(t,a.animates[a.animates.length-1].name);var r=o(n);r>-1?(i[r].param=a,i[r].frame=0):i.push({obj:n,frame:0,param:a}),s(n,a.animates[0]),$listen(n,"webkitAnimationEnd",e),$listen(n,"animationEnd",e)}};var s=function(e,t){t&&e&&window.setTimeout(function(){var n=t.name,a=t.duration+"s",i=t.timing,o=t.count;$(e).css("animation-name",n).css("-webkit-animation-name",n).css("animation-duration",a).css("-webkit-animation-duration",a).css("animation-delay","").css("-webkit-animation-delay","0").css("animation-timing-function",i).css("-webkit-animation-timing-function",i).css("animation-iteration-count",o).css("-webkit-animation-iteration-count",o)},1e3*("undefined"!=t.delay?t.delay:0))}};var TTXP_DA=new function(){this.click=function(e){try{MtaH5.clickStat(e)}catch(t){}}},TTXP_UI=new function(){this.MessageBox=new function(){var e="ttxp_msg_box_ok_cancel";this.show=function(t){var n='<div class="ttxp_messagebox_content">                    <div class="ttxp_messagebox_title"><strong>弹窗标题</strong></div>                    <div class="ttxp_messagebox_info">自定义弹窗内容<br></div>                    <div class="ttxp_messagebox_ft">                        <a href="javascript:;" class="ttxp_msg_box_btn_cancel">取消</a>                        <a href="javascript:;" class="ttxp_msg_box_btn_ok">确定</a>                    </div>                </div>',a=$("#"+e);if(!a.length){var i=document.createElement("div");$(i).addClass("ttxp_messagebox").css("display","none").css("z-index",99999).css("position","absolute").attr("id",e).html(n),$("body").append(i),a=$("#"+e)}t&&null!=t.title&&void 0!=t.title&&a.find(".ttxp_messagebox_title strong").text(t.title),t&&t.message&&a.find(".ttxp_messagebox_info").html(t.message),a.find(".ttxp_msg_box_btn_ok").on("click",function(){t&&t.ok&&t.ok(),a.hide(),a.remove()}),a.find(".ttxp_msg_box_btn_cancel").on("click",function(){t&&t.cancel&&t.cancel(),a.hide(),a.remove()}),a.show()},this.hide=function(){var t=$("#"+e);t.length&&(t.hide(),t.remove())}},this.LoadingToast=new function(){var e="ttxp_loading_toast";this.show=function(t){var n='                <div class="ttxp-toast-mask"></div>                <div class="ttxp-toast">                    <div class="ttxp-toast-loading">                        <div><span></span></div>                        <div><span></span></div>                        <div><span></span></div>                    </div>                    <p class="ttxp-toast-content">数据加载中</p>                </div>            ',a=$("#"+e);if(!a.length){var i=document.createElement("div");$(i).css("display","none").css("z-index",99999).css("position","absolute").attr("id",e).html(n),$("body").append(i),a=$("#"+e)}t&&a.find(".ttxp-toast-content").text(t),a.show()},this.hide=function(){var t=$("#"+e);t.length&&(t.hide(),t.remove())},this.setText=function(t){if(t){var n=$("#"+e);n.length&&n.find(".ttxp-toast-content").text(t)}}}};$listen(document,"DOMContentLoaded",function(){console.log("DOMContentLoaded");try{var e=window.location.href,t=[];t=e.split("/");var n=t[t.length-1];t=n.split("?");var a=new Date,i=a.getTime()-__time_begin.getTime();QOS_Stat("DOMLoaded_"+t[0],i)}catch(o){console.log("Exception when DOMContentLoaded")}});var LOG=new function(){this.trace=function(e,t){this.info(e,t)},this.info=function(t,n){e("T",t,n)},this.warn=function(t,n){e("W",t,n)},this.error=function(t,n){e("E",t,n)};var e=function(e,t,n){try{console.log("["+e+"]["+(t||"")+"]"+(n||""))}catch(a){}}},PreLoad=new function(){function e(e,t,n){var a=new Image;a.onload=function(){t&&t()},a.onerror=function(){n&&n()},a.src=e}this.load=function(t){for(var n=t&&t.files,a=n.length,i=0,o=0,s=function(e,n,a){t&&t.progress&&t.progress(e,n,a),e+n==a&&t&&t.complete&&t.complete(e,n,a)},r=0;a>r;++r){var c=n[r];switch(c.type){case"image":e(c.url,function(){s(++i,o,a)},function(){s(i,++o,a)});break;case"js":loadJSFile(c.url,function(){s(++i,o,a)},function(){s(i,++o,a)});break;case"css":s(i,++o,a);break;default:s(i,++o,a)}}}},wxAPI=new function(){var e="wxAPI",t=null,n=0;this.init=function(t,n,a,i){var o=this;if(this.isWx()){QOS_Stat("PageInWechat",0);var s=new Date;this._realInit(t,function(r){if(r){var c=new Date;n(!0);var l=c.getTime()-s.getTime();QOS_Stat("wxAPI_Result",l)}else LOG.warn(e,"init fail! try again"),o._realInit(t,function(e){var t=new Date;n(e);var a=t.getTime()-s.getTime();QOS_Stat("wxAPI_Result",a),e?QOS_Stat("wxAPI_Fail2Success",0):QOS_Stat("wxAPI_Fail2Fail",0)},a,i,3e4)},a,i,9e3)}else LOG.info(e,"Page is not in wechat"),QOS_Stat("PageNotInWechat",0),n(!1)},this._realInit=function(t,a,i,o,s){LOG.info(e,"req init wx api");var r=["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone","onMenuShareWeibo","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","chooseImage","uploadImage"],c=!1,l=function(e){return 1==c?!1:(c=!0,a(e),!0)},p=function(a,i,o,c){LOG.info(e,"req __init_wx_api");try{var p=new Date;n=p.getTime(),wx.config({debug:t,appId:a,timestamp:i,nonceStr:o,signature:c,jsApiList:r}),LOG.info(e,"finished wx.config"),window.setTimeout(function(){l(!1)&&(LOG.info(e,"wx config timeout"),QOS_Error("InitWxApiTimeout"))},s)}catch(d){LOG.error(e,"exception when wx.config:"+d.description)}};if(o)if("0"==o.ret){LOG.info(e,"get jsapi, req wx config");var d=o.data;p(d.appId,d.timestamp,d.noncestr,d.signature)}else l(!1),QOS_Error("ReqJsApiFail");else LOG.info(e,"request wx sig"),$.ajax({type:"POST",url:"http://api.ttxuanpai.com/cgi-bin/get_jsapi_signature",data:JSON.stringify({url:location.href.split("#")[0]}),success:function(t,n){if(LOG.info(e,"res get_jsapi:"+JSON.stringify(t)),"0"==t.ret){LOG.info(e,"get jsapi, req wx config");var a=t.data;p(a.appId,a.timestamp,a.noncestr,a.signature)}else LOG.info(e,"request jsapi failed, status:"+n),l(!1),QOS_Error("ReqJsApiFail")},fail:function(){LOG.error(e,"request jsapi failed"),l(!1),QOS_Error("ReqJsApiFail")},error:function(){LOG.error(e,"request jsapi error"),l(!1),QOS_Error("ReqJsApiFail")},dataType:"json"});wx.ready(function(){LOG.info(e,"wx ready");var t=new Date;QOS_Stat("wx.ready",t.getTime()-n),l(!0)}),wx.error(function(t){LOG.error(e,"wx onerror, res:"+JSON.stringify(t)),l(!1),QOS_Error("WxError")})},this.downloadImage=function(e,t){LOG.error("do not support downloadImage")},this.uploadImage=function(e,n){null==t&&(t=new wxImgUploader),t.pushTask(e,n)},this.isWx=function(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)}},TTXP_Image=new function(){this.loadImage=function(e){var t=new Image;t.onload=function(){e&&e.success&&e.success(this)},t.onerror=function(){e&&e.fail&&e.fail(this)},t.src=e.url},this.clip=function(e,t,n,a,i){var o,s,r,c;a/i>t/n?(s=n,o=Math.floor(n*(a/i))):(o=t,s=Math.floor(t*(i/a))),r=(o-t)/2,c=(s-n)/2,$(e).width(o).height(s).css("left",0-r+"px").css("top",0-c+"px"),e.style.clip="rect("+c+"px "+Math.floor(r+t)+"px "+Math.floor(c+n)+"px "+r+"px)"}};